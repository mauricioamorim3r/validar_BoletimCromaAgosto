{% extends "base.html" %}

{% block title %}Editar Boletim - Validação de Boletins Cromatográficos{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2 class="mb-4" style="font-family: var(--bs-font-sans-serif); font-size: 1.75rem; font-weight: var(--bs-body-font-weight); line-height: var(--bs-body-line-height); background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 16px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 6px;">
            <i class="bi bi-pencil"></i> Editar Boletim: {{ boletim.numero_boletim }}
        </h2>
        
        <!-- Botão Voltar -->
        <div class="mb-3">
            <a href="{{ url_for('listar_boletins') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Voltar para Lista
            </a>
        </div>
        
        <form method="post" id="editarForm">
            <!-- Cabeçalho da planilha -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="border p-3 bg-light">
                        <h6 class="text-primary">INFORMAÇÕES DO BOLETIM</h6>
                        
                        <!-- Primeira linha: Número do Documento, Número do Boletim, Data de Coleta, Data de Emissão -->
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="numero_documento" class="form-label small">Número do Documento</label>
                                <input type="text" class="form-control form-control-sm" id="numero_documento" name="numero_documento" value="{{ boletim.numero_documento }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="numero_boletim" class="form-label small">Número do Boletim</label>
                                <input type="text" class="form-control form-control-sm" id="numero_boletim" name="numero_boletim" value="{{ boletim.numero_boletim }}" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="data_coleta" class="form-label small">Data de Coleta</label>
                                <input type="date" class="form-control form-control-sm" id="data_coleta" name="data_coleta" value="{{ boletim.data_coleta }}" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="data_emissao" class="form-label small">Data de Emissão</label>
                                <input type="date" class="form-control form-control-sm" id="data_emissao" name="data_emissao" value="{{ boletim.data_emissao }}" required>
                            </div>
                        </div>
                        
                        <!-- Segunda linha: Agente Regulado, Plataforma -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="agente_regulado" class="form-label small">Agente Regulado</label>
                                <input type="text" class="form-control form-control-sm" id="agente_regulado" name="agente_regulado" value="{{ boletim.agente_regulado }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="plataforma" class="form-label small">Plataforma</label>
                                <input type="text" class="form-control form-control-sm" id="plataforma" name="plataforma" value="{{ boletim.plataforma }}" required>
                            </div>
                        </div>
                        
                        <!-- Terceira linha: Instalação, Sistema de Medição, Ponto de Coleta, Classificação -->
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="identificacao_instalacao" class="form-label small">Instalação</label>
                                <input type="text" class="form-control form-control-sm" id="identificacao_instalacao" name="identificacao_instalacao" value="{{ boletim.identificacao_instalacao }}" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="sistema_medicao" class="form-label small">Sistema de Medição</label>
                                <input type="text" class="form-control form-control-sm" id="sistema_medicao" name="sistema_medicao" value="{{ boletim.sistema_medicao }}" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="ponto_coleta" class="form-label small">Ponto de Coleta</label>
                                <input type="text" class="form-control form-control-sm" id="ponto_coleta" name="ponto_coleta" value="{{ boletim.ponto_coleta }}" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="classificacao" class="form-label small">Classificação</label>
                                <input type="text" class="form-control form-control-sm" id="classificacao" name="classificacao" value="{{ boletim.classificacao }}" required>
                            </div>
                        </div>
                        
                        <!-- Quarta linha: Data de Recebimento, Data de Análise, Data de Validação, Responsável Amostragem -->
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="data_recebimento" class="form-label small">Data de Recebimento</label>
                                <input type="date" class="form-control form-control-sm" id="data_recebimento" name="data_recebimento" value="{{ boletim.data_recebimento }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="data_analise" class="form-label small">Data de Análise</label>
                                <input type="date" class="form-control form-control-sm" id="data_analise" name="data_analise" value="{{ boletim.data_analise }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="data_validacao" class="form-label small">Data de Validação</label>
                                <input type="date" class="form-control form-control-sm" id="data_validacao" name="data_validacao" value="{{ boletim.data_validacao }}">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="responsavel_amostragem" class="form-label small">Responsável Amostragem</label>
                                <input type="text" class="form-control form-control-sm" id="responsavel_amostragem" name="responsavel_amostragem" value="{{ boletim.responsavel_amostragem }}" required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Condições do Processo -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="border p-3 bg-light">
                        <h6 class="text-primary">CONDIÇÕES DO PROCESSO</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="pressao" class="form-label small">Pressão (atm)</label>
                                <input type="number" step="0.01" class="form-control form-control-sm" id="pressao" name="pressao" value="{{ boletim.pressao }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="temperatura" class="form-label small">Temperatura (°C)</label>
                                <input type="number" step="0.01" class="form-control form-control-sm" id="temperatura" name="temperatura" value="{{ boletim.temperatura }}" required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Responsáveis -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="border p-3 bg-light">
                        <h6 class="text-primary">RESPONSÁVEIS</h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="responsavel_tecnico" class="form-label small">Responsável Técnico</label>
                                <input type="text" class="form-control form-control-sm" id="responsavel_tecnico" name="responsavel_tecnico" value="{{ boletim.responsavel_tecnico }}">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="responsavel_elaboracao" class="form-label small">Responsável Elaboração</label>
                                <input type="text" class="form-control form-control-sm" id="responsavel_elaboracao" name="responsavel_elaboracao" value="{{ boletim.responsavel_elaboracao }}">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="responsavel_aprovacao" class="form-label small">Responsável Aprovação</label>
                                <input type="text" class="form-control form-control-sm" id="responsavel_aprovacao" name="responsavel_aprovacao" value="{{ boletim.responsavel_aprovacao }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Observações -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="border p-3 bg-light">
                        <h6 class="text-primary">OBSERVAÇÕES</h6>
                        <textarea class="form-control" id="observacoes" name="observacoes" rows="3">{{ boletim.observacoes }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Componentes existentes (apenas visualização) -->
            {% if componentes %}
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="border p-3 bg-info bg-opacity-10">
                        <h6 class="text-info">
                            <i class="bi bi-info-circle"></i> COMPONENTES CADASTRADOS
                            <small class="text-muted">(Para editar os componentes, vá para a página de visualização do boletim)</small>
                        </h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Componente</th>
                                        <th>Valor (%)</th>
                                        <th>Status AGA</th>
                                        <th>Status CEP</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for comp in componentes %}
                                    <tr>
                                        <td>{{ comp.nome }}</td>
                                        <td>{{ "%.4f"|format(comp.percentual_molar) }}</td>
                                        <td>
                                            <span class="badge {% if comp.status_aga == 'VALIDADO' %}badge-success{% else %}badge-danger{% endif %}">
                                                {{ comp.status_aga or 'PENDENTE' }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge {% if comp.status_cep == 'VALIDADO' %}badge-success{% else %}badge-danger{% endif %}">
                                                {{ comp.status_cep or 'PENDENTE' }}
                                            </span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Botões de Ação -->
            <div class="text-center">
                <button type="submit" class="btn btn-warning btn-lg me-3">
                    <i class="bi bi-check-circle"></i> Salvar Alterações
                </button>
                <a href="{{ url_for('listar_boletins') }}" class="btn btn-secondary btn-lg">
                    <i class="bi bi-x-circle"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.getElementById('editarForm').addEventListener('submit', function(e) {
    if (!confirm('Confirma a alteração dos dados do boletim {{ boletim.numero_boletim }}?')) {
        e.preventDefault();
    }
});
</script>
{% endblock %}
