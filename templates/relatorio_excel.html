{% extends "base.html" %}

{% block content %}
<style>
    /* Aplicando a fonte Inter e melhorias visuais */
    .card, .table, .btn, .form-control, .form-label, label, th, td, h4, h5, h6, input, select, textarea {
        font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif !important;
    }
    
    .card-header.primary-header, .card-header.bg-primary {
        background: linear-gradient(135deg, #1e40af, #3b82f6) !important;
        color: white;
        border-radius: 8px 8px 0 0;
        padding: 15px 20px;
        font-weight: 600;
    }
    
    .card {
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
        margin-bottom: 20px;
    }
    
    .table th {
        font-size: 0.9rem;
        font-weight: 600;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        color: #374151;
        padding: 12px 10px;
    }
    
    .form-control {
        border-radius: 6px;
        border: 1px solid #cbd5e1;
        transition: all 0.2s ease;
    }
    
    .form-control:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .form-label {
        font-weight: 600;
        color: #374151;
        margin-bottom: 6px;
    }
    
    .btn {
        border-radius: 6px;
        font-weight: 500;
        padding: 10px 16px;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #1e40af, #3b82f6);
        border: none;
    }
    
    .btn-success {
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, #64748b, #475569);
        border: none;
    }
    
    .control-buttons .btn {
        min-width: 140px;
    }
    
    .excel-container .card-header h4, .excel-container .card-header h6 {
        color: white;
        font-weight: 600;
    }
</style>

<div class="excel-container">

<div class="row">
    <div class="col-md-12">
        <!-- Cabeçalho SGM -->
        <div class="card mb-3">
            <div class="card-header primary-header">
                <h4 class="mb-0">VISUALIZAÇÃO DE BOLETINS VALIDADOS</h4>
            </div>
        </div>

        <!-- Botões de Controle -->
        <div class="control-buttons mb-3 d-flex flex-wrap gap-2">
            {% if not edit_mode %}
                <a href="{{ url_for('relatorio', boletim_id=boletim.id, edit_mode='edit') }}" class="btn btn-primary flex-fill flex-md-grow-0">
                    <i class="bi bi-pencil"></i> Editar Boletim
                </a>
                <a href="{{ url_for('listar_boletins') }}" class="btn btn-secondary flex-fill flex-md-grow-0">
                    <i class="bi bi-arrow-left"></i> Voltar
                </a>
                <a href="{{ url_for('relatorio_pdf', boletim_id=boletim.id) }}" class="btn btn-success flex-fill flex-md-grow-0">
                    <i class="bi bi-file-earmark-pdf"></i> Gerar PDF
                </a>
            {% else %}
                <button type="button" id="salvar-btn" class="btn btn-success flex-fill flex-md-grow-0">
                    <i class="bi bi-check"></i> Salvar Alterações
                </button>
                <a href="{{ url_for('relatorio', boletim_id=boletim.id) }}" class="btn btn-secondary flex-fill flex-md-grow-0">
                    <i class="bi bi-x"></i> Cancelar
                </a>
            {% endif %}
        </div>

    {% if edit_mode %}
    <form method="post" id="editForm" action="{{ url_for('relatorio', boletim_id=boletim.id, edit_mode='edit') }}">
    {% endif %}

    <!-- Informações do Boletim -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-info-circle"></i> INFORMAÇÕES DO BOLETIM</h6>
        </div>
        <div class="card-body">
            <!-- Primeira linha: Número do Documento, Número do Boletim, Data de Coleta, Data de Emissão -->
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="numero_documento" class="form-label small">Número do Documento</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="numero_documento" name="numero_documento" value="{{ boletim['numero_documento'] or (boletim['id']|string + '/2025') }}">
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="numero_documento" name="numero_documento" value="{{ boletim['numero_documento'] or (boletim['id']|string + '/2025') }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="numero_boletim" class="form-label small">Número do Boletim</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="numero_boletim" name="numero_boletim" value="{{ boletim['numero_boletim'] }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="numero_boletim" name="numero_boletim" value="{{ boletim['numero_boletim'] }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="data_coleta" class="form-label small">Data de Coleta</label>
                    {% if edit_mode %}
                        <input type="date" class="form-control form-control-sm" id="data_coleta" name="data_coleta" value="{{ boletim['data_coleta'] or '' }}">
                    {% else %}
                        <input type="date" class="form-control form-control-sm" id="data_coleta" name="data_coleta" value="{{ boletim['data_coleta'] }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="data_emissao" class="form-label small">Data de Emissão</label>
                    {% if edit_mode %}
                        <input type="date" class="form-control form-control-sm" id="data_emissao" name="data_emissao" value="{{ boletim['data_emissao'] or '' }}">
                    {% else %}
                        <input type="date" class="form-control form-control-sm" id="data_emissao" name="data_emissao" value="{{ boletim['data_emissao'] }}" readonly>
                    {% endif %}
                </div>
            </div>
            
            <!-- Segunda linha: Agente Regulado, Plataforma -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="agente_regulado" class="form-label small">Agente Regulado</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="agente_regulado" name="agente_regulado" value="{{ boletim['agente_regulado'] }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="agente_regulado" name="agente_regulado" value="{{ boletim['agente_regulado'] }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="plataforma" class="form-label small">Plataforma</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="plataforma" name="plataforma" value="{{ boletim['plataforma'] or 'FPSO ATLANTE' }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="plataforma" name="plataforma" value="{{ boletim['plataforma'] or 'FPSO ATLANTE' }}" readonly>
                    {% endif %}
                </div>
            </div>
            
            <!-- Terceira linha: Instalação, Sistema de Medição, Ponto de Coleta, Classificação -->
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="identificacao_instalacao" class="form-label small">Instalação</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="identificacao_instalacao" name="identificacao_instalacao" value="{{ boletim['identificacao_instalacao'] }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="identificacao_instalacao" name="identificacao_instalacao" value="{{ boletim['identificacao_instalacao'] }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="sistema_medicao" class="form-label small">Sistema de Medição</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="sistema_medicao" name="sistema_medicao" value="{{ boletim['sistema_medicao'] or 'GÁS COMBUSTÍVEL LP' }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="sistema_medicao" name="sistema_medicao" value="{{ boletim['sistema_medicao'] or 'GÁS COMBUSTÍVEL LP' }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="ponto_coleta" class="form-label small">Ponto de Coleta</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="ponto_coleta" name="ponto_coleta" value="{{ boletim['ponto_coleta'] or 'LP FUEL GAS' }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="ponto_coleta" name="ponto_coleta" value="{{ boletim['ponto_coleta'] or 'LP FUEL GAS' }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="classificacao" class="form-label small">Classificação</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="classificacao" name="classificacao" value="{{ boletim['classificacao'] or 'FISCAL' }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="classificacao" name="classificacao" value="{{ boletim['classificacao'] or 'FISCAL' }}" readonly>
                    {% endif %}
                </div>
            </div>
            
            <!-- Quarta linha: Data de Recebimento, Data de Análise, Data de Validação, Responsável Amostragem -->
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="data_recebimento" class="form-label small">Data de Recebimento</label>
                    {% if edit_mode %}
                        <input type="date" class="form-control form-control-sm" id="data_recebimento" name="data_recebimento" value="{{ boletim['data_recebimento'] if boletim['data_recebimento'] else '' }}">
                    {% else %}
                        <input type="date" class="form-control form-control-sm" id="data_recebimento" name="data_recebimento" value="{{ boletim['data_recebimento'] if boletim['data_recebimento'] else '' }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="data_analise" class="form-label small">Data de Análise</label>
                    {% if edit_mode %}
                        <input type="date" class="form-control form-control-sm" id="data_analise" name="data_analise" value="{{ boletim['data_analise'] if boletim['data_analise'] else '' }}">
                    {% else %}
                        <input type="date" class="form-control form-control-sm" id="data_analise" name="data_analise" value="{{ boletim['data_analise'] if boletim['data_analise'] else '' }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="data_validacao" class="form-label small">Data de Validação</label>
                    {% if edit_mode %}
                        <input type="date" class="form-control form-control-sm" id="data_validacao" name="data_validacao" value="{{ boletim['data_validacao'] if boletim['data_validacao'] else '' }}">
                    {% else %}
                        <input type="date" class="form-control form-control-sm" id="data_validacao" name="data_validacao" value="{{ boletim['data_validacao'] if boletim['data_validacao'] else '' }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-3 mb-3">
                    <label for="responsavel_amostragem" class="form-label small">Responsável Amostragem</label>
                    {% if edit_mode %}
                        <input type="text" class="form-control form-control-sm" id="responsavel_amostragem" name="responsavel_amostragem" value="{{ boletim['responsavel_amostragem'] }}" required>
                    {% else %}
                        <input type="text" class="form-control form-control-sm" id="responsavel_amostragem" name="responsavel_amostragem" value="{{ boletim['responsavel_amostragem'] }}" readonly>
                    {% endif %}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Condições do Processo -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-thermometer-half"></i> CONDIÇÕES DO PROCESSO</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="pressao" class="form-label small">Pressão (atm)</label>
                    {% if edit_mode %}
                        <input type="number" step="0.01" class="form-control form-control-sm" id="pressao" name="pressao" value="{{ boletim['pressao'] or '' }}">
                    {% else %}
                        <input type="number" step="0.01" class="form-control form-control-sm" id="pressao" name="pressao" value="{{ boletim['pressao'] }}" readonly>
                    {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="temperatura" class="form-label small">Temperatura (°C)</label>
                    {% if edit_mode %}
                        <input type="number" step="0.01" class="form-control form-control-sm" id="temperatura" name="temperatura" value="{{ boletim['temperatura'] or '' }}">
                    {% else %}
                        <input type="number" step="0.01" class="form-control form-control-sm" id="temperatura" name="temperatura" value="{{ boletim['temperatura'] }}" readonly>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Composição Cromatográfica -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-graph-up"></i> COMPOSIÇÃO CROMATOGRÁFICA</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="componentes-excel">
                    <thead>
                        <tr>
                            <th>COMPONENTE</th>
                            <th>UNIDADE</th>
                            <th>VALOR NUMÉRICO</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="component-name">Metano, CH₄</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="metano_ch4" class="form-control form-control-sm text-center" value="{{ componentes_dict['metano_ch4'] if 'metano_ch4' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ componentes_dict['metano_ch4']|number_format(4) if 'metano_ch4' in componentes_dict and componentes_dict['metano_ch4'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">Etano, C₂H₆</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="etano_c2h6" class="form-control form-control-sm text-center" value="{{ componentes_dict['etano_c2h6'] if 'etano_c2h6' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ componentes_dict['etano_c2h6']|number_format(4) if 'etano_c2h6' in componentes_dict and componentes_dict['etano_c2h6'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">Propano, C₃H₈</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="propano_c3h8" class="form-control form-control-sm text-center" value="{{ componentes_dict['propano_c3h8'] if 'propano_c3h8' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['propano_c3h8']) if 'propano_c3h8' in componentes_dict and componentes_dict['propano_c3h8'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">i-Butano, i-C₄H₁₀</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="i_butano_ic4h10" class="form-control form-control-sm text-center" value="{{ componentes_dict['i_butano_ic4h10'] if 'i_butano_ic4h10' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['i_butano_ic4h10']) if 'i_butano_ic4h10' in componentes_dict and componentes_dict['i_butano_ic4h10'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">n-Butano, n-C₄H₁₀</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="n_butano_nc4h10" class="form-control form-control-sm text-center" value="{{ componentes_dict['n_butano_nc4h10'] if 'n_butano_nc4h10' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['n_butano_nc4h10']) if 'n_butano_nc4h10' in componentes_dict and componentes_dict['n_butano_nc4h10'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">i-Pentano, i-C₅H₁₂</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="i_pentano_ic5h12" class="form-control form-control-sm text-center" value="{{ componentes_dict['i_pentano_ic5h12'] if 'i_pentano_ic5h12' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['i_pentano_ic5h12']) if 'i_pentano_ic5h12' in componentes_dict and componentes_dict['i_pentano_ic5h12'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">n-Pentano, n-C₅H₁₂</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="n_pentano_nc5h12" class="form-control form-control-sm text-center" value="{{ componentes_dict['n_pentano_nc5h12'] if 'n_pentano_nc5h12' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['n_pentano_nc5h12']) if 'n_pentano_nc5h12' in componentes_dict and componentes_dict['n_pentano_nc5h12'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">n-Hexano, n-C₆H₁₄</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="c6_mais" class="form-control form-control-sm text-center" value="{{ componentes_dict['c6_mais'] if 'c6_mais' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['c6_mais']) if 'c6_mais' in componentes_dict and componentes_dict['c6_mais'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">n-Heptano, n-C₇H₁₆</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="heptano_c7h16" class="form-control form-control-sm text-center" value="{{ componentes_dict['heptano_c7h16'] if 'heptano_c7h16' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['heptano_c7h16']) if 'heptano_c7h16' in componentes_dict and componentes_dict['heptano_c7h16'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">n-Octano, n-C₈H₁₈</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="octano_c8h18" class="form-control form-control-sm text-center" value="{{ componentes_dict['octano_c8h18'] if 'octano_c8h18' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['octano_c8h18']) if 'octano_c8h18' in componentes_dict and componentes_dict['octano_c8h18'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">n-Nonano, n-C₉H₂₀</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="nonano_c9h20" class="form-control form-control-sm text-center" value="{{ componentes_dict['nonano_c9h20'] if 'nonano_c9h20' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['nonano_c9h20']) if 'nonano_c9h20' in componentes_dict and componentes_dict['nonano_c9h20'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">n-Decano, n-C₁₀H₂₂</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="decano_c10h22" class="form-control form-control-sm text-center" value="{{ componentes_dict['decano_c10h22'] if 'decano_c10h22' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['decano_c10h22']) if 'decano_c10h22' in componentes_dict and componentes_dict['decano_c10h22'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">Oxigênio, O₂</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="oxigenio_o2" class="form-control form-control-sm text-center" value="{{ componentes_dict['oxigenio_o2'] if 'oxigenio_o2' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['oxigenio_o2']) if 'oxigenio_o2' in componentes_dict and componentes_dict['oxigenio_o2'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">Nitrogênio, N₂</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="nitrogenio_n2" class="form-control form-control-sm text-center" value="{{ componentes_dict['nitrogenio_n2'] if 'nitrogenio_n2' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['nitrogenio_n2']) if 'nitrogenio_n2' in componentes_dict and componentes_dict['nitrogenio_n2'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="component-name">Dióxido de Carbono, CO₂</td>
                            <td class="text-center">% mol</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="number" step="0.0001" name="dioxido_carbono_co2" class="form-control form-control-sm text-center" value="{{ componentes_dict['dioxido_carbono_co2'] if 'dioxido_carbono_co2' in componentes_dict else '' }}">
                                {% else %}
                                    <span class="numeric">{{ "%.4f"|format(componentes_dict['dioxido_carbono_co2']) if 'dioxido_carbono_co2' in componentes_dict and componentes_dict['dioxido_carbono_co2'] else '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">
                            <td class="component-name" style="font-weight: bold;">TOTAL</td>
                            <td class="numeric" style="font-weight: bold;">% mol</td>
                            <td class="numeric" style="font-weight: bold;">100,0000</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- Seção 1: Check List -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-list-check"></i> CHECK LIST NBR ISO/IEC 17025</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="checklist-table table table-striped table-hover table-sm mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white; width: 60px;" class="text-center">ITEM</th>
                            <th scope="col" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;" class="text-center">DESCRIÇÃO</th>
                            <th scope="col" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white; width: 140px;" class="text-center">SITUAÇÃO</th>
                            <th scope="col" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white; width: 160px;" class="text-center">NÃO APLICÁVEL</th>
                            <th scope="col" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white; width: 200px;" class="text-center">OBSERVAÇÃO</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in checklist %}
                        <tr>
                            <td class="text-center">{{ item['item_numero'] }}</td>
                            <td>{{ item['descricao'] }}</td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <select name="checklist_{{ item['item_numero'] }}_situacao" class="form-select form-select-sm">
                                        <option value="">Selecionar</option>
                                        <option value="OK" {% if item['situacao'] == 'OK' %}selected{% endif %}>✓ OK</option>
                                        <option value="NOK" {% if item['situacao'] == 'NOK' %}selected{% endif %}>✗ NOK</option>
                                    </select>
                                {% else %}
                                    {% if item['situacao'] == 'OK' %}
                                        <span class="badge bg-success">✓</span>
                                    {% else %}
                                        <span class="badge bg-danger">✗</span>
                                    {% endif %}
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <select name="checklist_{{ item['item_numero'] }}_nao_aplicavel" class="form-select form-select-sm">
                                        <option value="">Selecionar</option>
                                        <option value="0" {% if not item['nao_aplicavel'] %}selected{% endif %}>Não</option>
                                        <option value="1" {% if item['nao_aplicavel'] %}selected{% endif %}>Sim</option>
                                    </select>
                                {% else %}
                                    {% if item['nao_aplicavel'] %}
                                        <span class="badge bg-secondary">Sim</span>
                                    {% endif %}
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if edit_mode %}
                                    <input type="text" name="checklist_{{ item['item_numero'] }}_observacao" value="{{ item['observacao'] or '' }}" class="form-control form-control-sm text-center">
                                {% else %}
                                    {{ item['observacao'] or '-' }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Seção 2: Objetivo -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-bullseye"></i> OBJETIVO</h6>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="objetivo" class="form-label small">Descrição do Objetivo</label>
                <textarea class="form-control form-control-sm" id="objetivo" name="objetivo" rows="3">Validar os resultados analíticos conforme metodologia A.G.A #8 e Controle Estatístico de Processo (CEP).</textarea>
            </div>
        </div>
    </div>

    <!-- Seção 3: Análise CEP - Oculta no modo edição -->
    {% if not edit_mode %}
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-bar-chart"></i> ANÁLISE CEP</h6>
        </div>
        <div class="card-body p-0">
            
            <!-- Componentes -->
            <div class="table-responsive">
                <table class="table table-striped table-hover table-sm mb-0 validation-table">
                    <thead class="table-dark">
                        <tr>
                            <th rowspan="2" class="align-middle" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Item</th>
                            <th rowspan="2" class="align-middle" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Componente</th>
                            <th rowspan="2" class="align-middle" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">% Molar</th>
                            <th colspan="2" class="text-center" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Status</th>
                            <th colspan="2" class="text-center" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">A.G.A 8</th>
                            <th colspan="2" class="text-center" style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">CEP</th>
                        </tr>
                        <tr>
                            <th style="background: linear-gradient(135deg, #1e40af, #1e40af); color: white;">A.G.A 8</th>
                            <th style="background: linear-gradient(135deg, #1e40af, #1e40af); color: white;">CEP</th>
                            <th style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Limite Inferior</th>
                            <th style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Limite Superior</th>
                            <th style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">Limite Inferior</th>
                            <th style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">Limite Superior</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comp in componentes %}
                        <tr>
                            <td class="text-center"><strong>{{ loop.index }}</strong></td>
                            <td>{{ comp['nome'] }}</td>
                            <td class="text-end">{{ comp['percentual_molar'] | number_format(3) }}%</td>
                            <td class="text-center">
                                <span class="badge bg-{{ 'success' if comp['status_aga'] == 'VALIDADO' else 'danger' }}">
                                    {{ comp['status_aga'] }}
                                </span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-{{ 'success' if comp['status_cep'] == 'VALIDADO' else 'danger' }}">
                                    {{ comp['status_cep'] }}
                                </span>
                            </td>
                            <td class="text-end" style="background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(37, 99, 235, 0.1)); border-left: 3px solid #1e40af;">
                                {% if comp['nome'] == 'Propano' %}0%{% elif comp['nome'] in ['i-Butano', 'n-Butano'] %}0%{% elif comp['nome'] in ['i-Pentano', 'n-Pentano'] %}0%{% elif comp['nome'] == 'Oxigênio' %}0%{% else %}0%{% endif %}
                            </td>
                            <td class="text-end" style="background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(37, 99, 235, 0.1));">
                                {% if comp['nome'] == 'Propano' %}12%{% elif comp['nome'] in ['i-Butano', 'n-Butano'] %}6%{% elif comp['nome'] in ['i-Pentano', 'n-Pentano'] %}4%{% elif comp['nome'] == 'Oxigênio' %}21%{% else %}100%{% endif %}
                            </td>
                            <td class="text-end" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.1)); border-left: 3px solid #10b981;">
                                {% if comp['cep_lci'] is not none %}{{ comp['cep_lci'] | number_format(3) }}%{% else %}-{% endif %}
                            </td>
                            <td class="text-end" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.1));">
                                {% if comp['cep_lcs'] is not none %}{{ comp['cep_lcs'] | number_format(3) }}%{% else %}-{% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <!-- PROPRIEDADES DO FLUIDO -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-gear"></i> PROPRIEDADES DO FLUIDO</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover table-sm mb-0 validation-table">
                    <thead class="table-dark">
                        <tr>
                            <th rowspan="2" class="align-middle" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Propriedade</th>
                            <th rowspan="2" class="align-middle" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Valor</th>
                            <th colspan="2" class="text-center" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Status</th>
                            <th colspan="2" class="text-center" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">A.G.A 8</th>
                            <th colspan="2" class="text-center" style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">CEP</th>
                        </tr>
                        <tr>
                            <th style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">A.G.A 8</th>
                            <th style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">CEP</th>
                            <th style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Limite Inferior</th>
                            <th style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white;">Limite Superior</th>
                            <th style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">Limite Inferior</th>
                            <th style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">Limite Superior</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for prop in propriedades %}
                        <tr>
                            <td>{{ prop['nome'] }}</td>
                            <td class="text-end">{{ prop['valor'] | number_format(4) }}</td>
                            <td class="text-center">
                                <span class="badge bg-{{ 'success' if prop['status_aga'] == 'VALIDADO' else 'danger' }}">
                                    {{ prop['status_aga'] }}
                                </span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-{{ 'success' if prop['status_cep'] == 'VALIDADO' else 'danger' }}">
                                    {{ prop['status_cep'] }}
                                </span>
                            </td>
                            <td class="text-center" style="background-color: #f8f9fa;">---</td>
                            <td class="text-center" style="background-color: #f8f9fa;">---</td>
                            <td class="text-end" style="background-color: #e8f5e8;">
                                {% if prop['nome'] == 'Fator de Compressibilidade' %}0.99771
                                {% elif prop['nome'] == 'Massa Específica' %}0.6659
                                {% elif prop['nome'] == 'Massa Molecular' %}15.9888{% endif %}
                            </td>
                            <td class="text-end" style="background-color: #e8f5e8;">
                                {% if prop['nome'] == 'Fator de Compressibilidade' %}0.99824
                                {% elif prop['nome'] == 'Massa Específica' %}0.7962
                                {% elif prop['nome'] == 'Massa Molecular' %}17.4312{% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Seção 4: Observações -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-chat-text"></i> OBSERVAÇÕES E INFORMAÇÕES COMPLEMENTARES</h6>
        </div>
        <div class="card-body">
            {% if edit_mode %}
                <textarea name="observacoes" class="form-control" rows="6">{{ boletim['observacoes'] or '1) Amostra apresentou altas concentrações de Nitrogênio sendo um indício de contaminação da amostra por ar, o que acabou impactando no percentual de C1.
2) O BRA será revalidado e resultado da análise não deverá ser aceito devido as anormalidades computadas do vazão.
Uma nova amostra deverá ser coletada no prazo de 3 (três) dias úteis a partir da data de avaliação da amostra.' }}</textarea>
            {% else %}
                <div class="border p-3 rounded bg-light">
                    {% if boletim['observacoes'] %}
                        {{ boletim['observacoes']|replace('\n', '<br>')|safe }}
                    {% else %}
                        <p class="mb-2">1) Amostra apresentou altas concentrações de Nitrogênio sendo um indício de contaminação da amostra por ar, o que acabou impactando no percentual de C1.</p>
                        <p class="mb-2">2) O BRA será revalidado e resultado da análise não deverá ser aceito devido as anormalidades computadas do vazão.</p>
                        <p class="mb-0">Uma nova amostra deverá ser coletada no prazo de 3 (três) dias úteis a partir da data de avaliação da amostra.</p>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Resultado Final -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0"><i class="bi bi-check-circle"></i> RESULTADO DA VALIDAÇÃO</h6>
        </div>
        <div class="card-body">
            <div class="row text-center g-3">
                <div class="col-md-4">
                    <div class="p-4 h-100" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h5 class="mb-2">CEP</h5>
                        <h4 class="mb-0">INVALIDADO</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 h-100" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h5 class="mb-2">A.G.A #8</h5>
                        <h4 class="mb-0">VALIDADO</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 h-100" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h5 class="mb-2">CHECKLIST</h5>
                        <h4 class="mb-0">VALIDADO</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Validação de Prazos ANP - Regulamento Técnico 52 -->
    <div class="card mb-4">
        <div class="card-header" style="background: linear-gradient(135deg, #1e40af, #2563eb); color: white; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h6 class="mb-0" style="font-weight: 600;">
                <i class="bi bi-clock-history"></i> VALIDAÇÃO DE PRAZOS ANP - REGULAMENTO TÉCNICO 52
            </h6>
        </div>
        <div class="card-body">
            {% if validacao_prazos %}
            <!-- Status Geral dos Prazos -->
            <div class="row mb-3">
                <div class="col-md-12">
                    <div style="background: linear-gradient(135deg, {% if validacao_prazos.status_geral == 'CONFORME' %}#10b981, #34d399{% else %}#dc2626, #ef4444{% endif %}); color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 0;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong style="font-size: 1.1rem;">
                                    {% if validacao_prazos.status_geral == 'CONFORME' %}
                                        ✅ CONFORME - Todos os prazos dentro dos limites regulamentários
                                    {% else %}
                                        ❌ NÃO CONFORME - Prazos excedidos detectados
                                    {% endif %}
                                </strong>
                                {% if validacao_prazos.alertas %}
                                    <div class="small mt-1" style="opacity: 0.9;">
                                        <strong>Alertas:</strong> {{ validacao_prazos.alertas | join(', ') }}
                                    </div>
                                {% endif %}
                            </div>
                            <span style="background: rgba(255, 255, 255, 0.2); color: white; padding: 8px 16px; border-radius: 20px; font-size: 1rem; font-weight: 600; backdrop-filter: blur(5px);">
                                {{ validacao_prazos.status_geral }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detalhamento dos Prazos -->
            <div class="row g-3">
                <!-- Coleta → Emissão (25 dias) -->
                {% if validacao_prazos.prazo_coleta_emissao %}
                <div class="col-md-4">
                    <div class="card h-100" style="border: 2px solid {% if validacao_prazos.prazo_coleta_emissao.status == 'CONFORME' %}#10b981{% else %}#dc2626{% endif %}; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div class="card-header" style="background: linear-gradient(135deg, {% if validacao_prazos.prazo_coleta_emissao.status == 'CONFORME' %}#10b981, #34d399{% else %}#dc2626, #ef4444{% endif %}); color: white; padding: 16px; font-weight: 600;">
                            <h6 class="mb-0">Coleta → Emissão</h6>
                        </div>
                        <div class="card-body">
                            <p class="card-text small mb-2">
                                <strong>Limite:</strong> {{ validacao_prazos.prazo_coleta_emissao.prazo_limite }} dias<br>
                                <strong>Decorridos:</strong> {{ validacao_prazos.prazo_coleta_emissao.dias_decorridos or 'N/A' }} dias
                            </p>
                            <p class="card-text">
                                <span class="badge" style="background: {% if validacao_prazos.prazo_coleta_emissao.status == 'CONFORME' %}#10b981{% else %}#dc2626{% endif %}; color: white; padding: 6px 12px;">
                                    {{ validacao_prazos.prazo_coleta_emissao.status }}
                                </span>
                            </p>
                            <small class="text-muted">{{ validacao_prazos.prazo_coleta_emissao.mensagem }}</small>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Emissão → Validação (1 dia) -->
                {% if validacao_prazos.prazo_emissao_validacao %}
                <div class="col-md-4">
                    <div class="card h-100" style="border: 2px solid {% if validacao_prazos.prazo_emissao_validacao.status == 'CONFORME' %}#10b981{% else %}#dc2626{% endif %}; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div class="card-header" style="background: linear-gradient(135deg, {% if validacao_prazos.prazo_emissao_validacao.status == 'CONFORME' %}#10b981, #34d399{% else %}#dc2626, #ef4444{% endif %}); color: white; padding: 16px; font-weight: 600;">
                            <h6 class="mb-0">Emissão → Validação</h6>
                        </div>
                        <div class="card-body">
                            <p class="card-text small mb-2">
                                <strong>Limite:</strong> {{ validacao_prazos.prazo_emissao_validacao.prazo_limite }} dia<br>
                                <strong>Decorridos:</strong> {{ validacao_prazos.prazo_emissao_validacao.dias_decorridos or 'N/A' }} dias
                            </p>
                            <p class="card-text">
                                <span class="badge" style="background: {% if validacao_prazos.prazo_emissao_validacao.status == 'CONFORME' %}#10b981{% else %}#dc2626{% endif %}; color: white; padding: 6px 12px;">
                                    {{ validacao_prazos.prazo_emissao_validacao.status }}
                                </span>
                            </p>
                            <small class="text-muted">{{ validacao_prazos.prazo_emissao_validacao.mensagem }}</small>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Prazo Total (28 dias) -->
                {% if validacao_prazos.prazo_total %}
                <div class="col-md-4">
                    <div class="card h-100" style="border: 2px solid {% if validacao_prazos.prazo_total.status == 'CONFORME' %}#10b981{% else %}#dc2626{% endif %}; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div class="card-header" style="background: linear-gradient(135deg, {% if validacao_prazos.prazo_total.status == 'CONFORME' %}#10b981, #34d399{% else %}#dc2626, #ef4444{% endif %}); color: white; padding: 16px; font-weight: 600;">
                            <h6 class="mb-0">Prazo Total</h6>
                        </div>
                        <div class="card-body">
                            <p class="card-text small mb-2">
                                <strong>Limite:</strong> {{ validacao_prazos.prazo_total.prazo_limite }} dias<br>
                                <strong>Decorridos:</strong> {{ validacao_prazos.prazo_total.dias_decorridos or 'N/A' }} dias
                            </p>
                            <p class="card-text">
                                <span class="badge" style="background: {% if validacao_prazos.prazo_total.status == 'CONFORME' %}#10b981{% else %}#dc2626{% endif %}; color: white; padding: 6px 12px;">
                                    {{ validacao_prazos.prazo_total.status }}
                                </span>
                            </p>
                            <small class="text-muted">{{ validacao_prazos.prazo_total.mensagem }}</small>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            {% else %}
            <div class="alert alert-warning mb-0">
                <i class="bi bi-exclamation-triangle"></i>
                <strong>Dados insuficientes</strong> para validação de prazos. Certifique-se de que as datas estão preenchidas.
            </div>
            {% endif %}
        </div>
    </div>

    {% if edit_mode %}
    </form>
    {% endif %}

    <!-- Botões de Ação -->
    {% if edit_mode %}
    {% endif %}
</div>

{% if edit_mode %}
<script>
document.getElementById('salvar-btn').addEventListener('click', function() {
    const form = document.getElementById('editForm');
    const formData = new FormData(form);
    const submitButton = this;
    
    // Desabilitar botão e mostrar carregamento
    submitButton.disabled = true;
    submitButton.innerHTML = '<i class="bi bi-hourglass"></i> Salvando...';
    
    fetch(form.action, {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            // Sucesso - redirecionar para a página de visualização
            window.location.href = '{{ url_for("relatorio", boletim_id=boletim.id) }}';
        } else {
            // Erro - mostrar mensagem
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
    })
    .catch(error => {
        console.error('Erro ao salvar:', error);
        alert('Erro ao salvar alterações: ' + error.message);
        
        // Reabilitar botão
        submitButton.disabled = false;
        submitButton.innerHTML = '<i class="bi bi-check"></i> Salvar Alterações';
    });
});
</script>
{% endif %}

    </div>
</div>

{% endblock %}